<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Dobby Travel Assistant</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link rel="icon" type="image/png" href="dobby-logo.png">
<style>
/* â¬‡ï¸ ÙƒÙ„ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù) */
:root {
  --primary:#6366f1;--primary-dark:#4f46e5;--secondary:#8b5cf6;--success:#10b981;
  --warning:#f59e0b;--error:#ef4444;--bg-primary:#0f172a;--bg-secondary:#1e293b;
  --bg-tertiary:#334155;--text-primary:#f8fafc;--text-secondary:#cbd5e1;
  --text-muted:#64748b;--border:#334155;
}
body{font-family:'Inter',sans-serif;background:var(--bg-primary);color:var(--text-primary);margin:0;}
.app-container{max-width:1400px;margin:auto;padding:20px;display:flex;flex-direction:column;gap:20px;}
.header{background:var(--bg-secondary);border:1px solid var(--border);border-radius:24px;text-align:center;padding:30px;}
.title{font-size:2.5rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px;}
.subtitle{color:var(--text-secondary);margin-bottom:10px;}
.status-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);color:var(--success);padding:6px 14px;border-radius:30px;font-size:.9rem;}
.main-content{display:grid;grid-template-columns:1fr 300px;gap:20px;}
.chat-container{background:var(--bg-secondary);border:1px solid var(--border);border-radius:20px;display:flex;flex-direction:column;overflow:hidden;}
.chat-header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;padding:20px;display:flex;align-items:center;gap:10px;}
.chat-messages{flex:1;padding:20px;overflow-y:auto;min-height:400px;display:flex;flex-direction:column;gap:15px;}
.message{display:flex;gap:10px;}
.message-avatar img{width:40px;height:40px;border-radius:50%;background:#fff;}
.message-content{background:var(--bg-tertiary);border:1px solid var(--border);border-radius:16px;padding:12px 16px;max-width:70%;}
.user .message-content{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;border-bottom-right-radius:6px;}
.user{flex-direction:row-reverse;}
.chat-input{padding:15px;background:var(--bg-tertiary);border-top:1px solid var(--border);}
.suggestion-chip{background:var(--bg-secondary);border:1px solid var(--border);color:var(--text-secondary);padding:8px 14px;border-radius:20px;cursor:pointer;}
.suggestions{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px;}
.message-input{flex:1;border:2px solid var(--border);background:var(--bg-secondary);border-radius:25px;padding:14px 18px;color:var(--text-primary);}
.input-container{display:flex;gap:10px;}
.send-button{width:50px;height:50px;border:none;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;cursor:pointer;}
.place-card{background:rgba(245,158,11,.05);border:1px solid rgba(245,158,11,.1);border-radius:16px;padding:12px;margin-top:8px;}
.place-actions a{color:var(--primary);text-decoration:none;margin-right:10px;}
.sidebar{background:var(--bg-secondary);border:1px solid var(--border);border-radius:20px;padding:20px;}
.stat-card{background:var(--bg-tertiary);border:1px solid var(--border);border-radius:12px;padding:10px;text-align:center;}
.stat-number{font-size:1.4rem;color:var(--primary);}
.stat-label{font-size:.8rem;color:var(--text-muted);}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
</style>
</head>
<body>
<div class="app-container">
  <header class="header">
    <img src="dobby-logo.png" style="width:100px;height:100px;object-fit:contain;">
    <h1 class="title">Dobby Travel Assistant</h1>
    <p class="subtitle">Your smart travel companion â€” find places to eat, drink, and visit.</p>
    <div class="status-badge"><span>ğŸŸ¢ AI Ready</span></div>
  </header>

  <main class="main-content">
    <div class="chat-container">
      <div class="chat-header">
        <div class="message-avatar"><img src="dobby-logo.png" alt="logo"></div>
        <div><strong>Dobby Travel</strong><br><small>Ask about places to eat, drink, and visit.</small></div>
      </div>

      <div class="chat-messages" id="chatMessages">
        <div class="message assistant">
          <div class="message-avatar"><img src="dobby-logo.png"></div>
          <div class="message-content">
            <strong>Welcome to Dobby Travel Assistant!</strong><br><br>
            Ask me about places to eat, drink, or visit. Example: <em>"Find a coffee shop near me"</em>.<br><br>
            I can use your location if you allow it.
          </div>
        </div>
      </div>

      <div class="chat-input">
        <div class="suggestions">
          <div class="suggestion-chip" onclick="sendSuggestion('Find coffee near me')">â˜• Coffee near me</div>
          <div class="suggestion-chip" onclick="sendSuggestion('Best pizza in town')">ğŸ• Best pizza</div>
          <div class="suggestion-chip" onclick="sendSuggestion('Top tourist attractions nearby')">ğŸ“ Attractions</div>
        </div>
        <div class="input-container">
          <textarea id="messageInput" class="message-input" placeholder="Ask Dobby about places..."></textarea>
          <button id="sendButton" class="send-button" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
      </div>
    </div>

    <aside class="sidebar">
      <h3>Session Stats</h3>
      <div class="stats-grid">
        <div class="stat-card"><span id="placesFound" class="stat-number">0</span><div class="stat-label">Places</div></div>
        <div class="stat-card"><span id="queriesAnswered" class="stat-number">1</span><div class="stat-label">Queries</div></div>
      </div>
    </aside>
  </main>
</div>

<script type="module">
const CONFIG={GEOAPIFY_KEY:"5b4260b421284bbd8f5e10b656279436",DOBBY_KEY:"fw_3ZVw4csVhBzeyBqkw6NAt1jd",MAX_PLACES:6};
const state={userCoords:null};
const el={chat:document.getElementById('chatMessages'),input:document.getElementById('messageInput')};

document.addEventListener('DOMContentLoaded',()=>{tryGetLocation();});

function tryGetLocation(){
  if(!navigator.geolocation)return;
  navigator.geolocation.getCurrentPosition(p=>{
    state.userCoords={lat:p.coords.latitude,lon:p.coords.longitude};
  });
}

function addMessage(txt,sender='assistant'){
  const div=document.createElement('div');
  div.className='message '+sender;
  const av=document.createElement('div');
  av.className='message-avatar';
  av.innerHTML=sender==='assistant' ? '<img src="dobby-logo.png">' : 'ğŸ‘¤';
  const c=document.createElement('div');
  c.className='message-content';
  c.innerHTML=txt;
  div.append(av,c);
  el.chat.append(div);
  el.chat.scrollTop=el.chat.scrollHeight;
}

function sendSuggestion(t){el.input.value=t;sendMessage();}

async function sendMessage(){
  const q=el.input.value.trim();
  if(!q)return;
  addMessage(q,'user');el.input.value='';
  const lower=q.toLowerCase();
  const hasIntent=['restaurant','coffee','cafe','bar','pizza','attraction','museum','park'].some(k=>lower.includes(k));
  const city=extractCity(q);
  if(hasIntent){
    if(lower.includes('near me')&&state.userCoords) await searchPlaces(q,state.userCoords);
    else if(city) await searchPlaces(q,null,city);
    else if(state.userCoords) await searchPlaces(q,state.userCoords);
    else addMessage('Please allow location access or mention a city.','assistant');
  }else addMessage('Ask me about food or places near you!','assistant');
}

function extractCity(t){
  const m=t.match(/\b(?:in|at)\s+([A-Za-z\s]+)/i);
  return m?m[1].trim():null;
}

async function searchPlaces(q,coords=null,city=null){
  addMessage('Searching places...','assistant');
  const term=derivePlaceText(q);
  let url='';
  if(coords){
    url=`https://api.geoapify.com/v2/places?categories=catering.restaurant,catering.cafe,catering.bar&filter=circle:${coords.lon},${coords.lat},5000&limit=${CONFIG.MAX_PLACES}&apiKey=${CONFIG.GEOAPIFY_KEY}`;
  }else if(city){
    url=`https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(term+' in '+city)}&limit=${CONFIG.MAX_PLACES}&apiKey=${CONFIG.GEOAPIFY_KEY}`;
  }
  try{
    const r=await fetch(url);
    const d=await r.json();
    const f=d.features||[];
    if(!f.length){addMessage("No results found.","assistant");return;}
    addMessage(`Found ${f.length} results:`,`assistant`);
    f.forEach(x=>{
      const p=x.properties;
      const html=`<div class="place-card"><div><strong>${p.name||p.formatted}</strong><br>${p.formatted||''}</div>
      <div class="place-actions"><a target="_blank" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.formatted||p.name)}">View</a></div></div>`;
      addMessage(html,'assistant');
    });
  }catch(e){addMessage('Error: '+e.message,'assistant');}
}

function derivePlaceText(t){
  const k=['coffee','cafe','restaurant','pizza','bar','museum','park','beach'];
  const l=t.toLowerCase();
  for(const x of k){if(l.includes(x))return x;}
  return t;
}
</script>
</body>
</html>
